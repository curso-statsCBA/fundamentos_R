---
title: "Gr치ficos con R base"
pagetitle: "Gr치ficos con R base"
---

## El apartado gr치fico de R

La representaci칩n gr치fica de datos y resultados es una parte importante de nuestro quehacer habitual en 치mbitos acad칠micos y cient칤ficos. Una de las razones de la gran popularidad de R yace en su excelente apartado gr치fico, con el cual se pueden producir gr치ficos de buena calidad listos para publicar. De forma general, existen <u id='comentario'>dos m칠todos principales</u> para realizar gr치ficos en R: el basado en el sistema b치sico de `R base` y el basado en el paquete `ggplot2`. Ambas opciones poseen sus propias ventajas y desventajas y generalmente son usados a la par. Es decir, en algunas ocasiones convendr치 o ser치 m치s c칩modo, utilizar uno y, en otras ocasiones, ser치 mejor opci칩n el otro.

```{r, echo=FALSE}
tippy::tippy_this(elementId = 'comentario', interactive= 'true', tooltip = "<span style='font-size:14px;'>Existen otros paquetes que profundizan funcionalidades espec칤ficas que trascienden los objetivos de este curso. Aqu칤 puede encontrar <a href='https://www.geeksforgeeks.org/top-r-libraries-for-data-visualization/' target='_blank'>una lista de los paquetes top en 2024</a> seg칰n un sitio especializado.</span>")
```

En esta clase veremos como construir gr치ficos con `R base`. Para empezar, definiremos un concepto relativo al *nivel* de la funci칩n utilizada. Cuando grafiquemos podremos utilizaremos funciones de *alto nivel*, que son aquellas funciones que crean nuevos gr치ficos, generalmente junto a los principales ejes, etiquetas 칩 t칤tulos (e.g. `plot()`, `hist()`, etc.); y funciones de *bajo nivel*, que son aquellas con las que podremos a침adir elementos extras a un gr치fico ya creado, como puntos, l칤neas, flechas u otras etiquetas (e.g. `points()`, `text()`, etc.). La **combinaci칩n de funciones de alto y bajo nivel nos permite realizar una enorme personalizaci칩n del gr치fico**, aunque en algunas ocasiones esto puede llevar a que tengamos que definir cada aspecto del mismo. Este compromiso entre el nivel de personalizaci칩n deseado y la cantidad de l칤neas de c칩digo necesarias puede parecer un poco abrumador al comienzo; pero, luego de un tiempo, en general optaremos siempre por una completa personalizaci칩n. Sumado a esto, con el tiempo acumularemos plantillas propias para ciertos tipos de gr치ficos que realicemos frecuentemente, y solo nos bastar치 con cambiar los datos y algunos par치metros menores para obtener un nuevo gr치fico listo para su publicaci칩n (o al menos su revisi칩n 游땳).

En cuanto a los **tipos de gr치ficos**, las posibilidades que ofrece R son realmente ilimitadas y podr칤an constituir en s칤 mismo un curso de representaci칩n gr치fica. Por ello, para aprender los fundamentos del funcionamiento del apartado gr치fico, veremos a continuaci칩n dos tipos de gr치ficos:

-   **Histogramas**: nos permiten ver la distribuci칩n de frecuencia en nuestros datos.
-   **Gr치ficos de dispersi칩n (*scatterplots*)**: nos permiten evaluar la relaci칩n entre variables cuantitativas.
-   **Gr치ficos de caja (*boxplot*)**: posibilitan comparar, entre categor칤as, la distribuci칩n cuantitativa de los datos basada en sus cuartiles y mostrando, adem치s, intervalos de confianza y valores at칤picos (*outliers*).

En cuanto a la **personalizaci칩n de los gr치ficos**, intentaremos a continuaci칩n abordarlo desde una perspectiva progresiva, partiendo de los gr치ficos simples elaborados con funciones de alto nivel, para luego ir sumando par치metros y funciones de bajo nivel, haciendo m치s complejo nuestro c칩digo para definir los principales elementos que componen un gr치fico.

------------------------------------------------------------------------

### Un gr치fico simple

En el primer d칤a de clases, ya realizamos nuestro primer gr치fico sencillo. Podemos, con todo lo que sabemos ahora, entender perfectamente como funciona el siguiente c칩digo:

```{r eval=F, echo=T, fig.align='center', fig.height=3, fig.width=4}
plot(1:3, rep(1,3), pch=16, col=c("blue","red","black"), cex=5)
```

```{r eval=T, echo=F, fig.align='center', fig.height=3}
par(mar = c(2, 2, 1, 2))
plot(1:3, rep(1,3), pch=16, col=c("blue","red","black"), cex=5)
```

Empezando por los datos, ya sabemos que la expresi칩n `1:3` genera un vector compuesto por `1,2,3`, as칤 mismo `rep(1,3)` est치 generando una repetici칩n de 1, tres veces, es decir: `1,1,1`. La funci칩n `plot()` espera 2 argumentos posicionales correspondientes a las coordenadas `x` e `y`, respectivamente. Por ende, lo que estamos haciendo es indicar que las posiciones para el eje `x=(1,2,3)` y las posiciones para el eje `y=(1,1,1)`. De all칤 que los 3 puntos graficados se ubiquen en las coordenadas `(x,y)=(1,1),(1,2),(1,3)`.

#### *Los par치metros b치sicos* `pch`*,* `col` *y* `cex`

Con estos tres par치metros b치sicos de la funci칩n `plot()` podemos indicar que tipo de **marcador** se graficar치 (`pch`), que **colores** queremos que estos marcadores tengan y que **tama침o relativo** queremos que tengan (`cex`). Debajo podemos ver un ejemplo, pero nunca esta de m치s tener a mano una carta de referencia descargada en nuestra PC o un sitio que podamos [consultar online](https://r-charts.com/){target="_bank"}. Notar que a los colores podemos indicarlos con un *n칰mero* del 1 al 8 (luego comienzan a ciclarse) como se muestra aqu칤 abajo, o con sus *nombres* (e.g. '*black*', '*red*', etc.) como en el ejemplo previo; as칤 como tambi칠n podemos usar notaci칩n [hexadecimal o RGB](https://r-charts.com/colors/){target="\"_blank"}.

```{r eval=T, echo=F, fig.align='center', fig.height=5, fig.width=12}
par(mar = c(2, 3, 1, 1))
num <- 0 ; 
num1 <- 0
plot(0,0 , xlim=c(0,26) , ylim=c(0.5,3.5), col="white" , xaxt="n", yaxt="n" , ylab="" , xlab="")
#fill the graph
for (i in seq(1,25)){
  points(i,1 , pch=i , cex=3, col="black" , bg="lightblue")
  points(i,2 , col=i , pch=16 , cex=3)
  points(i,3 , col="black" , bg="lightblue", pch=21 , cex=i*0.25)
}
for (i in seq(1,25)){
  text(i, 1-0.25 , i, cex=0.9)
  text(i, 2-0.25 , i, cex=0.9)
  text(i, 3-0.3 , i*0.25, srt=0, adj=0.5, cex=0.9)
}
#add axis
axis(2, at = c(1,2,3), labels = c("pch" , "col" , "cex"), 
     tick = TRUE, col = "black", las = 1, cex.axis = 1, font.axis=2)
```

## Ejercicio 1

Utilizando como molde el c칩digo del gr치fico previo, intente realizar uno que posea 3 puntos en las coordenadas `(x,y)=(1,3),(2,1),(3,2)`, que estos puntos sean rombos de color azul, amarillo y rojo, respectivamente, todos con borde negro, y que su tama침o relativo sea distinto y creciente, como se muestra a continuaci칩n:

```{r eval=T, echo=F, fig.align='center', fig.height=4, fig.width=5}
par(mar = c(3, 2, 1, 1))
plot(1:3, c(3,1,2), pch=23, col="black", bg=c("blue","yellow","red"), cex=c(1,2,3))
```

*Ayuda*: los valores de `cex` recomendados son `1,2,3`. Para las formas con borde y relleno, `col` solo especifica el color del borde. Busque por sus medios qu칠 par치metro permite indicar el color de relleno.

## Histogramas

Los histogramas son gr치ficos que nos permiten visualizar la distribuci칩n de frecuencia de los datos. Son muy utilizados en el *an치lisis exploratorio* de los datos. Graficar histogramas en R es sumamente sencillo gracias a la funci칩n `hist()`, una funci칩n de alto nivel que permite realizarlos. Para el siguiente ejemplo, visualizaremos una distribuci칩n normal de 1.000 observaciones con `media = 0` y `desviaci칩n estandar = 0` .

```{r eval=T, echo=T, fig.align='center', fig.height=4, fig.width=5}
hist(rnorm(1000))
```

### *Editando t칤tulos y etiquetas de ejes*

Como podemos ver, el gr치fico muestra una serie de barras con la frecuencia acumulada de los valores por intervalos igualmente espaciados. As칤 mismo, como se trata de una funci칩n de alto nivel, ya posee configurado algunas cuestiones, como las etiquetas de los ejes y el t칤tulo. Para modificar esto 칰ltimo podr칤amos incluir los par치metros `xlab` e `ylab`, para las etiquetas de los ejes `x` e `y`, respectivamente y `main` para el t칤tulo:

```{r eval=T, echo=T, fig.align='center', fig.height=4, fig.width=6}
hist(rnorm(1000),
     main = "Histograma de Distribuci칩n Normal",
     xlab = "Valores observados",
     ylab = "Frecuencias"
)
```

## Ejercicio 2

Ayud치ndose con la documentaci칩n de las funciones `hist()` y `rnorm()`:

a)  Grafique un histograma correspondiente a un ensayo de medici칩n de la altura de una poblaci칩n para los cuales se midieron 350 personas y se obtuvo un valor promedio de 175 cm, con una desviaci칩n est치ndar de 5 cm.

b)  Imagine que este ensayo se repiti칩 en diferentes localidades, y ahora se encuentra con 30.000 observaciones, con media 173,47 cm y desviaci칩n est치ndar de 4,03 cm. Le han pedido que realice un nuevo histograma y le han informado que la editorial donde va a ser publicado el informe ha solicitado que el mismo posea t칤tulo, etiquetas, colores de relleno y borde de las barras del histograma, muy espec칤ficos. Para tal fin, le han adjuntado el ejemplo que se muestra debajo. Realice el nuevo gr치fico y gu치rdelo en la carpeta correspondiente a `dia4`.

```{r eval=T, echo=F, fig.align='center', fig.height=4, fig.width=6}
hist(rnorm(30000, 173.47, 4.03),
     col = "pink",
     border = "blue",
     main = "Altura de la poblaci칩n",
     xlab = "Valores observados (cm)",
     ylab = "Frecuencia poblacional"
)
```

c)  Puede que su gr치fico se vea muy parecido, m치s no igual al ejemplo. De hecho, cada vez que llama a la funci칩n gr치fica observar치 que el gr치fico cambia, 쯣or qu칠 sucede esto?

## Gr치fico de dispersi칩n

Muchas veces necesitamos evaluar si existe una relaci칩n entre 2 variables cuantitativas. Una de las mejores formas de representar gr치ficamente estas relaciones es mediante gr치ficos de dispersi칩n. A continuaci칩n un ejemplo utilizando el conjunto de datos `iris`, con el que ya deber칤a estar muy familiarizado.

```{r eval=F, echo=T, fig.align='center', fig.height=5, fig.width=5}
with(iris, plot(Petal.Length, Sepal.Length, 
                pch = 21, col = "black", bg = "forestgreen", cex = 1,
                xlim = c(0, 8),
                ylim = c(0, 8)
                )
     )
```

```{r eval=T, echo=F, fig.align='center', fig.height=5, fig.width=5}
par(mar=c(4,4,1,1))
with(iris, plot(Petal.Length, Sepal.Length, 
                pch= 21, col="black", bg="forestgreen", cex=1,
                xlim=c(0, 8),
                ylim=c(0, 8)))
```

**Para pensar:** En el c칩digo precedente apareci칩 `with()`, una funci칩n que previamente no hab칤amos utilizado. Analice el c칩digo y trate de descifrar que ventajas tiene su uso. Por supuesto, siempre puede consultar la ayuda con `?with()`.

### *L칤mites gr치ficos*

En el c칩digo del gr치fico previo, aparecieron algunas novedades: los par치metros `xlim` e `ylim`. Como puede imaginarse, se trata de los par치metros para fijar los l칤mites de los ejes. Ambos par치metros esperan un vector de largo 2 con los rangos de las coordenadas de `x` e `y`, y son muy 칰tiles a la hora de crear una base gr치fica sin ning칰n contenido, para luego rellenar con nuestros datos. Esta forma de trabajo es muy extendida al trabajar con gr치ficos b치sicos en R, y para ello cuando llamamos a la funci칩n `plot()` debemos indicarle que el gr치fico sea vac칤o, con el par치metro `typ = "n"`.

Antes de probar su funcionamiento, prestemos atenci칩n al origen de coordenadas del gr치fico (i.e. `(x,y)=(0,0)`). Si nos fijamos bien, veremos que esa coordenada no coincide exactamente con el 치ngulo inferior izquierdo del gr치fico. Esto es debido a que, por defecto, R utiliza una funci칩n interna para extender levemente los ejes (ahora que lo notamos, podemos ver que sucede tambi칠n en los extremos de los ejes). Si no deseamos este comportamiento, podemos utilizar los par치metros `xaxs` e `yaxs`. Estos par치metros tienen dos configuraciones posibles: `"r"` o `"i"` (de "regular" e "interno"), veamos como funcionan:

```{r eval=F, echo=T, fig.align='center', fig.height=3, fig.width=3}
plot(0,0, xlim = c(0, 100), ylim = c(0, 50), typ = "n", xaxs = "r", yaxs = "i")
```

```{r eval=T, echo=F, fig.align='center', fig.height=3, fig.width=3}
par(mar=c(2,2,1,1))
plot(0,0, xlim=c(0, 100), ylim=c(0, 50), typ='n', xaxs="r",yaxs="i")
```

### *A침adiendo otros elementos a nuestro gr치fico*

En el gr치fico de dispersi칩n, muchas veces es interesante mostrar el resultado de la correlaci칩n entre las variables de forma gr치fica, es decir, la l칤nea (o curva) resultante del ajuste de un modelo de regresi칩n entre las variables. Teniendo en cuenta el mismo conjunto de datos con el que venimos trabajando, recordemos primero como podemos obtener la regresi칩n lineal usando la funci칩n `lm()`.

```{r eval=T, echo=T}
lm(Sepal.Length ~ Petal.Length, data = iris)
```

Como podemos ver, la funci칩n `lm()` ya nos devuelve el intercepto y la pendiente de la recta que queremos graficar. Con el uso de la funci칩n `abline()`, podemos a침adirla al gr치fico:

```{r eval=F, echo=T, fig.align='center', fig.height=5, fig.width=5}
# plot() -> funci칩n de alto nivel, crea la base del gr치fico
with(iris, plot(Petal.Length, Sepal.Length,
                pch= 21, col="black", bg="forestgreen", cex=1,
                xlim=c(0, 8),
                ylim=c(0,8)))
# abline() -> funci칩n de bajo nivel, a침ade la recta al gr치fico ya creado
with(iris, abline(lm(Sepal.Length ~ Petal.Length)))
```

```{r eval=T, echo=F, fig.align='center', fig.height=5, fig.width=5}
par(mar=c(4,4,1,1))
with(iris, plot(Petal.Length, Sepal.Length, 
                pch= 21, col="black", bg="forestgreen", cex=1,
                xlim=c(0, 8),
                ylim=c(0,8)))
with(iris, abline(lm(Sepal.Length ~ Petal.Length)))
```

As칤 como a침adimos la recta resultante de la regresi칩n, con `abline()` podemos a침adir tantas l칤neas verticales y horizontales como necesitemos, esto es muy 칰til para separar sectores del gr치fico, hacer lineas de divisiones menores de los ejes, etc. Adem치s, podemos llamar a otra funci칩n de bajo nivel como es `text()`, para agregar sobre el gr치fico los valores que componen la ecuaci칩n de la recta:

```{r eval=F, echo=T, fig.align='center', fig.height=5, fig.width=5}
# Primero guardemos los resultados de la regresi칩n en un nuevo objeto
reg_l <- lm(Sepal.Length ~ Petal.Length, data = iris)

# Gr치fico base
with(iris, plot(Petal.Length, Sepal.Length,
                pch= 21, col="black", bg="forestgreen", cex=1,
                xlim=c(0, 8),
                ylim=c(0,8)))
# A침adimos l칤neas
abline(v = c(2, 4, 6), h = c(2, 4, 6), col = "grey", lwd = 0.5)
abline(reg_l)
# A침adiomos texto
text(3.5, 0, paste0("La ecuaci칩n es: y = ",
                    round(reg_l$coefficients[2],2),
                    "x", " + ",
                    round(reg_l$coefficients[1],2)),
     cex=0.9, adj=0)
```

```{r eval=T, echo=F, fig.align='center', fig.height=5, fig.width=5}
reg_l <- with(iris, lm(Sepal.Length ~ Petal.Length))
par(mar=c(4,4,1,1))
with(iris, plot(Petal.Length, Sepal.Length, 
                pch= 21, col="black", bg="forestgreen", cex=1,
                xlim=c(0, 8),
                ylim=c(0,8)))
abline(v=c(2,4,6), h=c(2,4,6), col="grey", lwd=0.5)
abline(reg_l)
text(3.5,0, paste0("La ecuaci칩n es: y = ",
                   round(reg_l$coefficients[2],2),
                   "x", " + ",
                   round(reg_l$coefficients[1],2)),
     cex=0.9, adj=0)
```

### *Personalizando par치metros seg칰n los datos*

En muchas ocasiones, necesitamos que en nuestro gr치fico los colores o los marcadores se correspondan con alguna variable, ya sea esta cuantitativa o cualitativa. Existen diferentes formas de abordar esta situaci칩n que depender치n en gran medida de la complejidad y el tama침o del conjunto de datos, as칤 como de la diversidad de par치metros que debamos modificar.

Una aproximaci칩n sencilla es generar en nuestro conjunto de datos una nueva variable que contenga los valores (num칠ricos o de texto) del par치metro gr치fico que necesitemos modificar. Otra forma puede ser utilizar un vector con nombres, que relacione las variables de los datos con los valores de los par치metros gr치ficos.

```{r eval=T, echo=T}
# Creando un nuevo data.frame para graficar incluyendo una columna con colores por especie
toplot <- iris[,c(1,3,5)]
toplot$Spe.Color <- ifelse(toplot$Species == "setosa", "forestgreen",
                           ifelse(toplot$Species == "versicolor", "dodgerblue",
                                  "red")
                           )
toplot[sample(nrow(toplot), 10),]
```

```{r eval=F, echo=T, fig.align='center', fig.height=6, fig.width=6}
# Creando una referencia para los marcadores, seg칰n la especie
pch_ref <- c("setosa" = 21,
             "versicolor" = 22,
             "virginica" = 23)
# Creando una referencia para los colores, seg칰n la especie
col_ref <- c("setosa" = "forestgreen",
             "versicolor" = "dodgerblue",
             "virginica" = "red")
# Llamando al gr치fico
with(toplot, plot(Sepal.Length, Petal.Length,
                  pch = pch_ref[as.character(Species)],
                  col = "black", bg = Spe.Color, cex = 1.5,
                  xlim = c(0, 8),
                  ylim = c(0,8)
                  )
)
# Usando un for para a침adir lineas de ajuste por especie
with(toplot,
     for (spe in unique(Species)) {
       abline(lm(Petal.Length ~ Sepal.Length,
                 data = subset(toplot, Species == spe)),
              col = col_ref[as.character(spe)], lwd = 3, lty = 3)
     }
)
```

```{r eval=T, echo=F, fig.align='center', fig.height=6, fig.width=6}
par(mar=c(4,4,1,1))
# Creando un nuevo data.frame para graficar incluyendo una columna con colores por especie
toplot <- iris[,c(1,3,5)]
toplot$Spe.Color <- ifelse(toplot$Species == "setosa", "forestgreen",
                     ifelse(toplot$Species == "versicolor", "dodgerblue",
                            "red"))
# Creando una referencia para los marcadores, seg칰n la especie
pch_ref <- c("setosa" = 21,
             "versicolor" = 22,
             "virginica" = 23)
# Creando una referencia para los colores, seg칰n la especie
col_ref <- c("setosa" = "forestgreen",
             "versicolor" = "dodgerblue",
             "virginica" = "red")
# Llamando al gr치fico
with(toplot, plot(Sepal.Length, Petal.Length,
                pch = pch_ref[as.character(Species)],
                col = "black", bg = Spe.Color, cex=1.5,
                xlim = c(0, 8),
                ylim = c(0,8)
                )
     )
# Usando un for para a침adir lineas de ajuste por especie
with(toplot,
     for (spe in unique(Species)) {
       abline(lm(Petal.Length ~ Sepal.Length,
                 data = subset(toplot, Species == spe)),
              col = col_ref[as.character(spe)], lwd = 3, lty = 3)
       }
     )
```

### *Editando los ejes del gr치fico*

En algunas ocasiones, quisi칠ramos que el gr치fico no presentar치 el recuadro que lo rodea. Esto podemos lograrlo removiendo los ejes con el par치metro `axes = FALSE`.

```{r eval=F, echo=T, fig.align='center', fig.height=5, fig.width=5}
# Llamando al gr치fico
with(toplot, plot(Sepal.Length, Petal.Length,
                pch = pch_ref[as.character(Species)],
                col = "black", bg = Spe.Color, cex=1.5,
                xlim = c(0, 8),
                ylim = c(0,8),
                axes=FALSE
                )
     )
```

```{r eval=T, echo=F, fig.align='center', fig.height=4, fig.width=4}
# Llamando al gr치fico
par(mar=c(5,5,1,1))
with(toplot, plot(Sepal.Length, Petal.Length,
                pch = pch_ref[as.character(Species)],
                col = "black", bg = Spe.Color, cex=1.5,
                xlim = c(0, 8),
                ylim = c(0,8),
                axes = FALSE
                )
     )
```

Por supuesto, ahora debemos *a침adir manualmente* los ejes del gr치fico. Para ello, usaremos otra funci칩n de bajo nivel llamada `axis()` (recuerde revisar la documentaci칩n para ver todas sus opciones) y, si as칤 queremos, `box()` para dibujar una secci칩n espec칤fica del recuadro que enmarca el gr치fico.

```{r eval=F, echo=T, fig.align='center', fig.height=5, fig.width=5}
# Llamando al gr치fico
with(toplot, plot(Sepal.Length, Petal.Length,
                pch = pch_ref[as.character(Species)],
                col = "black", bg = Spe.Color, cex=1.5,
                xlim = c(0, 8),
                ylim = c(0,8),
                xaxs = "i", yaxs = "i",
                axes = FALSE
                )
     )
axis(side = 1, at = c(0,4:8))
axis(side = 2, at = c(seq(0,8,2)), las = 1, labels = c("cero", "dos", 4, "seis", 8))
box(bty = "l")
```

```{r eval=T, echo=F, fig.align='center', fig.height=5, fig.width=5}
# Llamando al gr치fico
par(mar=c(5,5,1,1))
with(toplot, plot(Sepal.Length, Petal.Length,
                pch = pch_ref[as.character(Species)],
                col = "black", bg = Spe.Color, cex=1.5,
                xlim = c(0, 8),
                ylim = c(0,8),
                xaxs="i", yaxs="i",
                axes=FALSE
                )
     )
# A침adimos los ejes y el recuadro
axis(side=1, at=c(0,4:8))
axis(side=2, at=c(seq(0,8,2)), las=1, labels=c("cero", "dos", 4, "seis", 8))
box(bty="l")
```

## Gr치ficos de caja

### *Leyendas y anotaciones*

A continuaci칩n, cambiaremos el conjunto de datos por `ToohGrowth`, proveniente de un experimento de crecimiento dental en cobayos, seg칰n la dosis de dos suplementos dietarios. Este tipo de experimentos es perfecto para poner en pr치ctica la funci칩n `boxplot()`, para crear gr치ficos de caja. Como en este punto ya conocemos la l칩gica de construcci칩n de gr치ficos, pasemos directamente al c칩digo:

```{r eval=F, echo=T, fig.align='center', fig.height=5, fig.width=5}
# Llamado del primer conjunto de cajas (tratamiento = "VC")
with(subset(ToothGrowth, supp == "VC"),
     boxplot(len ~ dose, axes = FALSE, ylim = c(0, 35),
             boxwex = 0.15, at = 1:3 - 0.1, 
             col = "yellow", main = "Crecimiento dental",
             xlab = "Dosis de Vitamina C (mg/d칤a)", ylab = "Largo del odontoblasto (췃m)",
             )
     )
# Llamado del segundo conjunto de cajas (tratamiento = "OJ")
# Notar el uso de "add = TRUE" y "ann = FALSE"
with(subset(ToothGrowth, supp == "OJ"),
     boxplot(len ~ dose,  axes = FALSE, add = TRUE, ann = FALSE,
             boxwex = 0.15, at = 1:3 + 0.1,
             col = "orange"
             )
     )
# Creando los ejes y recuadro
axis(side = 1, at = c(1:3), labels = c("0.5", "1", "2"))
axis(side = 2, at = seq(0,35,5))
box(bty = "l", lwd = 2)
# Graficando la flecha para se침alar el outlier
with(subset(ToothGrowth, supp == "VC" & dose == 1),
     arrows(x0 = 1.5, x1 = 1.8,
            y0 = max(len), y1 = max(len),
            lwd = 2, col = "red"
  )
)
# Anadiendo la leyenda
legend("bottom", horiz = TRUE, bty = "n",
       legend = c("츼cido asc칩rbico", "Jugo de naranja"),
       fill = c("yellow", "orange"))
```

```{r eval=T, echo=F, fig.align='center', fig.height=6, fig.width=6}
with(subset(ToothGrowth, supp == "VC"),
     boxplot(len ~ dose,
             boxwex = 0.15, at = 1:3 - 0.1, axes = FALSE, ylim = c(0, 35),
             col = "yellow", main = "Crecimiento dental",
             xlab = "Dosis de Vitamina C (mg/d칤a)", ylab = "Largo del odontoblasto (췃m)",
             )
     )
with(subset(ToothGrowth,  supp == "OJ"),
     boxplot(len ~ dose, add = TRUE, ann = F, axes = FALSE,
             boxwex = 0.15, at = 1:3 + 0.1,
             col = "orange"
             )
     )
axis(side=1, at=c(1:3), labels=c("0.5", "1", "2"))
axis(side=2, at=seq(0,35,5))
box(bty="l", lwd=2)
with(subset(ToothGrowth, supp == "VC" & dose == 1),
     arrows(x0 = 1.5, x1 = 1.8,
            y0 = max(len), y1 = max(len),
            lwd = 2, col = "red"
  )
)
legend("bottom", horiz=TRUE, bty = "n",
       c("츼cido asc칩rbico", "Jugo de naranja"),
       fill = c("yellow", "orange"))
```

## Ejercicio 3

a)  Analice el c칩digo precedente sin ejecutarlo, intentando describir que hace cada l칤nea. Luego, copie el mismo a un script dentro de `dia4` y ejec칰telo por partes para entender el funcionamiento. Recuerde buscar en las ayudas interna de R y juegue con las opciones disponibles.
b)  Repita el gr치fico pero con una flecha azul que indique el valor de la mediana para la 0,5 mm/d칤a del suplemento jugo de naranja. Adem치s, ubique la leyenda en la posici칩n `(x,y) = (2.5,5)`.

<br>

## Panel de m칰ltiples gr치ficos

En muchas ocasiones, necesitamos mostrar en un solo panel varios gr치ficos diferentes. Para ello, debemos utilizar la funci칩n `par()`, que permite configurar todos los par치metros b치sicos del dispositivo gr치fico que usa R. Esta funci칩n tiene un nivel jer치rquico superior a todas las que vimos previamente, ya que con la misma podemos cambiar el comportamiento *por defecto* de todos los par치metros gr치ficos de forma semi-permanente (i.e. en el contexto de RStudio, durante toda la sesi칩n en curso; y para dispositivos gr치ficos externos, hasta que se reinicie el mismo). Por esto, si realizamos un cambio con `par()` para mostrar dos gr치ficos en paralelo y, posteriormente, queremos realizar un nuevo gr치fico solitario, debemos volver a configurar el dispositivo gr치fico para mostrar un solo gr치fico.

A pesar de la gran cantidad de usos que posee la funci칩n par(), dentro de los mas comunes est치n la configuraci칩n de m치rgenes interiores (`mar`/`mai`) y exteriores (`oma` y `omi`), as칤 como la configuraci칩n del emplazamiento de m칰ltiples gr치ficos (`mfrow`).

Para ver esto 칰ltimo en acci칩n, pensemos que queremos realizar una regresi칩n lineal y evaluar si los supuestos de la misma se cumplen. Para ellos, hagamos primero un modelo de regresi칩n lineal entre las variables `Petal.Length` y `Sepal.Length`, para la especie *I. virginica* del conjunto de datos `iris`:

```{r eval=T, echo=T, fig.align='center', fig.height=8, fig.width=8}
# Creando y viendo el resultado del modelo de regresi칩n lineal
regL <- lm(Petal.Length ~ Sepal.Length, data = subset(iris[iris$Species == "virginica",]))
summary(regL)
```

Habiendo generado el objeto que contiene el resultado de `lm()`, podemos pedirle a R que lo grafique con `plot()`. Este es un ejemplo m치s de la caracter칤stica de *polimorfismo* que vimos en la [clase introductoria](../dia1/IntroR.qmd){target="_blank"}, ya que `plot()` puede usarse sobre diferentes tipos de objetos, resultantes de diferentes funciones, y realizar치 diferentes gr치ficos seg칰n cada uno.

Como en nuestro ejemplo la funci칩n `plot()`realizar치 4 gr치ficos separados, configuraremos con `par()` la posibilidad de tener un panel de 4 gr치ficos, con 2 filas y 2 columnas, esto es: `mfrow = c(2,2)`.

```{r eval=T, echo=T, fig.align='center', fig.height=8, fig.width=8}
# Gr치ficos de diagn칩stico del modelo de regresi칩n lineal
par(mfrow = c(2,2))
plot(regL)
```

Si bien el an치lisis y explicaci칩n de cada uno de estos gr치ficos excede este curso, puede encontrar [en este v칤nculo](https://library.virginia.edu/data/articles/diagnostic-plots){target="_blank"} una buena explicaci칩n con ejemplos. Adem치s, **puede inscribirse en la pr칩xima edici칩n del excelente curso dictado por Santiago Benitez-Vieyra**: [Introducci칩n al lenguaje R. Modelos lineales y fundamentos de programaci칩n.](https://curso-statscba.github.io/curso-R/){target="_blank"}

Para jugar un poco m치s, repitamos los gr치ficos pero ahora, pidiendo que los mismos est칠n emplazados en una sola fila de 4 columnas:

```{r eval=T, echo=T, fig.align='center', fig.height=4, fig.width=10}
# Gr치ficos de diagn칩stico del modelo de regresi칩n lineal
par(mfrow = c(1,4))
plot(regL)
```

------------------------------------------------------------------------

## Ejercicio final

Con el conjuntos de datos provisto, y ayud치ndose con la documentaci칩n de las funciones `points()`, `segments()` y `title()`, y buscando como funcionan los par치metros gr치ficos para l칤neas `lwd` y `lty`, realice un gr치fico como el que se muestra a continuaci칩n.

```{r eval=T, echo=T}
data <- data.frame(tipo = c("linea solida","linea guiones","linea punteada", rep("punto",4)),
                   lposy = c(1,3,5, rep(NA,4)),
                   lposx0 = c(rep(1,3), rep(NA, 4)),
                   lposx1 = c(rep(4,3), rep(NA, 4)),
                   pposx = c(rep(NA,3), 6,6,8,8),
                   pposy = c(rep(NA,3), 2,4,2,4))
data 
```

```{r eval=T, echo=F, fig.align='center', fig.height=7, fig.width=7}
par(mar=c(2,2,3,1))
plot(0,0, typ="n", xlab="", ylab="", xlim=c(0,10), ylim=c(0,6), axes = FALSE)
axis(side=1, at=c(6,8))
axis(side=2, at=c(2,4))
box(bty="o")
with(data, abline(v=pposx, h=pposy))
with(subset(data, tipo == "punto"),
     points(pposx, pposy, cex=3, 
            pch = c(21,22,23,24),
            col = "black",
            bg = c("red", "dodgerblue", "orange", "forestgreen")))
with(subset(data, tipo != "punto"),
     segments(x0=lposx0, x1=lposx1, y0=lposy, y1=lposy,
              lwd=4, lty=c(1,2,3)))
with(subset(data, tipo != "punto"),
     text(lposx0, lposy+0.5, tipo, adj=0))
title("Graficando con R base")
```

------------------------------------------------------------------------

<p align="center">

<a href="pics/plotbasememe.jpeg" target="_blank"> <img src="pics/plotbasememe.jpeg" style="padding: 5px 0 5px 0;width: 50rem;max-width:100%;height:auto;vertical-align:middle;border-style: none;"/></a>

</p>
